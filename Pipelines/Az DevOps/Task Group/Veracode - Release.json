{"tasks":[{"environment":{},"displayName":"Config Veracode API","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"pip install veracode-api-signing","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","progressPreference":"silentlyContinue","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"","runScriptInSeparateScope":"false"},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}},{"environment":{},"displayName":"Veracode: Policy Check","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"$veracodeAppName = \"$(veracodeAppName)\"\n\nfunction Get-VeracodeAppDetails {\n    param (\n        $veracodeAppName\n    )\n    $appInfo = http --auth-type=veracode_hmac GET \"https://api.veracode.com/appsec/v1/applications/?name=$veracodeAppName\" | ConvertFrom-Json\n    return $appInfo\n}\n\nfunction Get-VeracodeFindingsPanel {\n    param (\n        $findings\n    )\n    foreach ($finding in $findings) {\n        $severity = $finding.finding_details.severity\n        $file_path = $finding.finding_details.file_path\n        $file_line_number = $finding.finding_details.file_line_number\n        $cwe = $finding.finding_details.cwe.name\n        $description = $finding.description\n        \n        # Exibe os resultados\n        Write-Host \"Severidade: $severity - Tipo: $cwe\"\n        Write-Host \"Onde: $file_path - Linha: $file_line_number\"\n        Write-Host \"Descricao:\"\n        Write-Host \"$description\"\n        Write-Host \"    \"\n    }\n}\n\n# Faz o loop de validacao\nwhile ($scanStatus -ne \"PUBLISHED\") {\n    $appInfo = Get-VeracodeAppDetails $veracodeAppName\n    $scanStatus = $appInfo._embedded.applications.scans.status\n    Write-Host \"Status atual do scan: $scanStatus\"\n    Start-Sleep -Seconds 5\n}\n\n# Pega as informacoes do outro scans\n$appGuid = $appInfo._embedded.applications.guid\n$results = http --auth-type=veracode_hmac GET \"https://api.veracode.com/appsec/v2/applications/$appGuid/findings?violates_policy=TRUE&size=10000\" | ConvertFrom-Json\n$findings = $results._embedded.findings\n$findingsCount = $findings.count\nif ($findingsCount -ne 0) {\n    Get-VeracodeFindingsPanel $findings\n    Write-Error \"Foram encontrados $findingsCount apontamentos\"\n}\n","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","progressPreference":"silentlyContinue","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"","runScriptInSeparateScope":"false"},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":6,"createdBy":{"displayName":"Ivo Dias","id":"bb8961b9-f454-699f-a68f-6f424a751c27","uniqueName":"igd753@gmail.com"},"createdOn":"2024-04-10T19:07:41.560Z","modifiedBy":{"displayName":"Ivo Dias","id":"bb8961b9-f454-699f-a68f-6f424a751c27","uniqueName":"igd753@gmail.com"},"modifiedOn":"2024-04-10T19:48:13.677Z","comment":"","id":"65019a2f-a766-47c2-8d28-b9c2e2348691","name":"Veracode - Release","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M237_20240408.14/_content/icon-meta-task.png","friendlyName":"Veracode - Release","description":"Validador de politica para deploy","category":"Deploy","definitionType":"metaTask","author":"Ivo Dias","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"veracodeAppName","label":"veracodeAppName","defaultValue":"$(Release.DefinitionName)","required":true,"type":"string","helpMarkDown":"Nome do projeto","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: Veracode - Release $(veracodeAppName)","preJobExecution":{},"execution":{},"postJobExecution":{},"_buildConfigMapping":{}}